package org.rdswitchboard.importers.ands.s3.ddb;

import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3Client;
import com.amazonaws.services.s3.model.ListObjectsRequest;

public class Reader {
	private final AmazonS3 s3client;
	
	public Reader(AWSCredentials awsCredentials) {
		s3client = new AmazonS3Client(awsCredentials);
	}
	
	public void process() {
		ListObjectsRequest listObjectsRequest = new ListObjectsRequest()
			.withBucketName(bucketName)
		.withPrefix("m");
		ObjectListing objectListing;

		do {
			objectListing = s3client.listObjects(listObjectsRequest);
			for (S3ObjectSummary objectSummary : 
				objectListing.getObjectSummaries()) {
				System.out.println( " - " + objectSummary.getKey() + "  " +
		                "(size = " + objectSummary.getSize() + 
						")");
			}
			listObjectsRequest.setMarker(objectListing.getNextMarker());
		} while (objectListing.isTruncated());
	}
}
